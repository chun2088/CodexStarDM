# PRD — 스타디엠 디지털 쿠폰 시스템 (MVP, Email Magic Link)

## 1. Elevator Pitch
스타디엠은 소상공인의 광고 집행을 돕는 B2B SaaS 기업으로, 보유한 약 4,000개 점포 기반에 **디지털 쿠폰북**을 결합해 고객 유입을 증대한다. 본 MVP는 고객의 **쿠폰 클레임→QR 사용**, 점주의 **쿠폰 발행·관리·스캔**, 영업의 **온보딩·승인**을 **단일 반응형 웹 + PWA**로 제공한다. 점주는 **구독형 결제(월/연)**로 쿠폰 기능을 이용하며, 자동 갱신을 통해 장기 사용을 유도한다. **인증은 이메일 매직링크(Passwordless)** 로 마찰을 최소화해 가장 빠르게 출시한다.

---

## 2. Who is this app for
- **고객(End-user)**: 매장 쿠폰을 검색·클레임·사용(방문 시 QR 제시)하는 사용자
- **점주(Merchant)**: 매장 등록, 쿠폰 제안·관리, QR 스캔으로 사용 처리, **구독 결제 관리**
- **영업(Sales @Stardm)**: 점포 등록(초대코드), 쿠폰 승인/관리, 담당 점포 현황 확인

---

## 3. Functional Requirements

### 플랫폼/공통
- **플랫폼**: 반응형 웹앱 + **PWA** (단일 코드베이스로 PC/모바일 동시 지원), HTTPS 필수
- **역할 분기**: 로그인 후 역할별 라우팅(고객/점주/영업)
- **데이터 로깅**: 쿠폰 발급/사용/구독 이벤트 전량 수집(향후 통계 확장 대비)

### 인증 (MVP: 이메일 매직링크)
- **이메일 매직링크(Passwordless)**: 이메일 입력 → 로그인 링크 발송 → 링크 클릭 시 즉시 로그인
- **보안**: 원타임 토큰, **짧은 TTL(예: 15분)**, 서버에는 **해시만 저장**, 사용 즉시 무효화
- **딥링크**: 메일앱에서 클릭 시 PWA로 자연스러운 복귀 처리
- **확장(차기)**: Google 소셜 로그인 추가 → 필요 시 카카오 알림톡/SMS OTP 보강

### 고객(End-user)
- (비로그인) 지역/카테고리로 매장·쿠폰 **검색/열람**
- (로그인) 쿠폰 **Claim → 내 월렛 저장**
- 매장 방문 시 월렛에서 쿠폰 선택 → **동적 QR 생성(유효 120초)**
- **재사용 방지**: 이미 사용된 쿠폰은 재사용 불가(만료 시 QR 재생성 가능)
- 내 쿠폰 상태 보기(사용 가능/사용됨/만료)

### 점주(Merchant)
- 영업이 제공한 **초대코드**로 계정 생성 및 매장 등록
- **구독 결제**: 플랜 선택(월/연), 자동 갱신, 결제 수단 관리, 구독 해지/재구독
- **쿠폰 Propose(제안)** 작성/수정(승인 대기 중에도 수정 가능)
- 영업 승인 시 **Public** 노출, 진행 쿠폰 **상태 변경**(일시중지/삭제)
- **스캔 모드**: 고객 QR 스캔 → **Redeem(사용 처리)**

### 영업(Sales)
- **본인 코드로 등록된 점포만** 열람/관리
- 점주 쿠폰 **승인/반려**, 필요 시 영업이 **직접 쿠폰 생성/수정**
- **초대코드 발급** 및 점포 상태/쿠폰 현황 확인

### 쿠폰/QR 동작 규칙
- **라이프사이클**: Draft → Pending(승인대기) → Active(공개) → Paused → Archived
- **동적 QR(토큰)**: 단건·단기간(120초) 유효, 서버 검증 후 1회성 사용 처리
- **동시성/중복 방지**: Redeem 시 원자적 업데이트(중복 사용 불가)

### 결제/구독(Billing) — MVP 범위
- **구독 모델**: 월/연 플랜, 자동 갱신(Autorenew), 결제 실패 시 재시도 로직(예: d+1, d+3)
- **결제 수단**: 카드(토큰화), 영수증(이메일), 과금 이력 조회
- **구독 상태**: Active/Grace(결제실패 유예)/Canceled
- **접근 제어**: 구독 상태에 따라 쿠폰 생성/스캔 기능 제한(예: Grace는 스캔 가능, Canceled는 비활성)

### (MVP 외/차기)
- 포인트/스탬프 멤버십, 고급 통계 대시보드, 멀티지점 관리, 앱스토어 네이티브 패키징(Capacitor)

---

## 4. User Stories

### 고객
- 사용자로서, **가까운 중국집 쿠폰을 검색**해 클레임하고 싶다.
- 사용자로서, **매장 방문 시 QR을 제시**해 즉시 혜택을 받고 싶다(120초 동적 QR).
- 사용자로서, 이미 사용한 쿠폰은 **재사용되지 않길** 원한다.

### 점주
- 점주로서, **초대코드로 빠르게 가입**하고 매장을 등록하고 싶다.
- 점주로서, **구독을 결제**하고 쿠폰 기능을 활성화하고 싶다(자동 갱신/해지 관리).
- 점주로서, **쿠폰을 제안**하고 승인 대기 중에도 **수정**할 수 있길 원한다.
- 점주로서, 손님이 제시한 **QR을 스캔해 바로 사용 처리**하고 싶다.

### 영업
- 영업으로서, **내가 등록시킨 점포 목록**과 상태를 한눈에 보고 싶다.
- 영업으로서, 점주가 제안한 **쿠폰을 승인/반려**하거나 필요 시 **직접 생성**하고 싶다.
- 영업으로서, 신규 점주 온보딩을 위해 **초대코드를 발급**하고 싶다.

---

## 5. User Interface

### 전반(반응형 웹 + PWA)
- 단일 웹앱을 반응형으로 설계, **모바일 우선** UI
- PWA 설치 지원(홈 화면 추가), 모바일 브라우저에서 **카메라 접근**(QR 스캔)
- 로그인 → **매직링크 입력 화면** → 역할별 홈 자동 라우팅

### 고객 화면
- **홈/검색**: 지역·카테고리 필터, 매장/쿠폰 카드 리스트
- **쿠폰 상세**: 혜택/조건 요약, **Claim** 버튼
- **내 월렛**: 보유 쿠폰 리스트(상태/만료), **QR 생성(120초 타이머 표시)**

### 점주 화면
- **온보딩**: 초대코드 입력 → 매장 정보 기입 → **구독 결제**
- **쿠폰 관리**: 목록(상태 필터), 작성/수정(상태: Draft/Pending/Active), **상태 토글(일시중지/삭제)**
- **스캔 모드**: 전용 풀스크린 카메라 뷰, 스캔 결과(성공/실패) 즉시 피드백
- **구독 관리**: 플랜/결제수단/영수증/해지

### 영업 화면
- **점포 리스트**(담당 점포만): 상태/최근 활동 표시
- **승인 대시보드**: Pending 쿠폰 승인/반려, 변경 이력
- **쿠폰 생성(대행)**: 점주 대신 생성/수정
- **초대코드 발급**: 코드 생성/만료, 사용 이력

---

> **MVP 목표**: 단일 PWA로 가장 빠르게 출시. **이메일 매직링크 로그인**을 기본으로 고객의 **Claim→QR 사용**, 점주의 **스캔 Redeem**, 영업의 **승인/온보딩**을 구현. 모든 이벤트 데이터를 적재해 추후 **통계/추천/세분화**로 확장 가능.
